# analyze
EVENT=post-create analyzer=Kerneloops
        # Generate duplication hashes
        abrt-action-analyze-oops || exit $?
        #
        # If it exists, we can save a copy of MCE log here:
        #test -f /var/log/mcelog && cp /var/log/mcelog .
        # but in current config, sosreport already does that.
        #
        # See if MCEs were seen but mcelog isn't installed or running
        dmesg | grep -qFi 'Machine check events logged' || exit 0
        #
        # There was an MCE. IOW: it's not a bug, it's a HW error.
        # (Ab)use user comment field to inform user about it.
        test -f /var/log/mcelog &&
        {
                echo "The kernel log indicates that hardware errors were detected."
                echo "/var/log/mcelog file may have more information."
                echo "The last 20 lines of /var/log/mcelog are:"
                echo "========================================="
                # Redirecting sterr in case selinux makes it unreadable
                # (annoying anyway, but at least user knows what's going on):
                tail -n20 /var/log/mcelog 2>&1
                exit 0
        } >comment
        #
        # Apparently, there is no running mcelog daemon!
        # Let user know that he needs one.
        {
        echo "The kernel log indicates that hardware errors were detected."
        echo "The data was saved by kernel for processing by the mcelog tool."
        echo "However, /var/log/mcelog file does not exist."
        echo "Most likely reason is that mcelog is not installed or not configured"
        echo "to be started during boot."
        echo "Without this tool running, the binary data saved by kernel"
        echo "is of limited usefulness."
        echo "(You can save this data anyway by running 'cat </dev/mcelog >FILE')."
        echo "The recommended course of action is to install mcelog."
        echo "If another hardware error would occur, a user-readable description"
        echo "of it will be saved in /var/log/mcelog."
        } >comment

# If you want behavior similar to one provided by kerneloops daemon
# distributed by kerneloops.org - that is, if you want
# oopses to be reported automatically and immediately without
# user interaction, uncomment this line:
#EVENT=post-create analyzer=Kerneloops
        reporter-kerneloops

# report
#EVENT=report_Kerneloops analyzer=Kerneloops
#        reporter-kerneloops

#EVENT=report_Bugzilla analyzer=Kerneloops
#        reporter-bugzilla -b
